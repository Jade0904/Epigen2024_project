---
title: "4_Temporal_Binding_Dynamics"
author: "Zhihan Zhu"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
```

```{r}
# import useful packages
suppressPackageStartupMessages({
  library(AnnotationHub)
  library(epiwraps)
  library(GenomicRanges)
  library(rtracklayer)
  library(Rsubread)
  library(R.utils)
})
```

## Temporal Binding Dynamics

In the pairwise comparisons analysis, we found that most of the colocated binding sites are found in non-dynamic peaks. We inferred that, this is because most of the TF dynamics happen between time point 0 and 1, and thus these differential binding sites can not be significantly detected if we do the differential analysis between time point 1 and 12, and actually aggregated in non-significant group. In this chapter, we are going to compare the peaks at different time points to verify this statement.

```{r}
# import peaks, only use replicate 2 for consistency and simplicity

# GR
GR_t1 <- rtracklayer::import("data/peaks/GR_t1_rep2.bed.gz", format = "narrowPeak")
GR_t12 <- rtracklayer::import("data/peaks/GR_t12_rep2.bed.gz", format = "narrowPeak")

# JUN
JUN_t1 <- rtracklayer::import("data/peaks/JUN_t1_rep2.bed.gz", format = "narrowPeak")
JUN_t12 <- rtracklayer::import("data/peaks/JUN_t12_rep2.bed.gz", format = "narrowPeak")

# JUNB
JUNB_t1 <- rtracklayer::import("data/peaks/JUNB_t1_rep2.bed.gz", format = "narrowPeak")
JUNB_t12 <- rtracklayer::import("data/peaks/JUNB_t12_rep2.bed.gz", format = "narrowPeak")
```

### use Upset plot to see the intersection

```{r}
# GR
suppressWarnings({
  GR_peaks <- list(GR_t1, GR_t12)
  names(GR_peaks) <- c("GR_t1", "GR_t12")
  regionUpset(GR_peaks)
})
```

```{r}
# JUN
suppressWarnings({
  JUN_peaks <- list(JUN_t1, JUN_t12)
  names(JUN_peaks) <- c("JUN_t1", "JUN_t12")
  regionUpset(JUN_peaks)
})
```

```{r}
# JUNB
suppressWarnings({
  JUNB_peaks <- list(JUNB_t1, JUNB_t12)
  names(JUNB_peaks) <- c("JUNB_t1", "JUNB_t12")
  regionUpset(JUNB_peaks)
})
```

It is true that most of the GR binding sites present at later time point (i.e. time point 12) were also present at early time point (i.e. time point 1). However, this is not true though, for JUN and JUNB. It is obvious that, for JUN and JUNB, the binding sites present at later time point are much more than that at early time point, and opposite to GR, nearly all of the JUN and JUNB binding sites present at early time point were also present at later time point.

So it's only true that GR dynamics happen between time point 0 and 1, but not the case for JUN and JUNB.

## Co-occurrence analysis

```{r}
# t1
suppressWarnings({
  t1_peaks <- list(GR_t1, JUN_t1, JUNB_t1)
  names(t1_peaks) <- c("GR_t1", "JUN_t1", "JUNB_t1")
  regionUpset(t1_peaks, set_size.show = TRUE)
})
```

```{r}
# t12
suppressWarnings({
  t12_peaks <- list(GR_t12, JUN_t12, JUNB_t12)
  names(t12_peaks) <- c("GR_t12", "JUN_t12", "JUNB_t12")
  regionUpset(t12_peaks, set_size.show = TRUE)
})
```

At the beginning of the treatment (time point 1), the co-occurrence of GR, JUN and JUNB happens quite often (4272 out of 8874 GR peaks). At late stage of the treatment (time point 12), the absolute number of co-occurrence peaks is decreasing, however it becomes the most part of GR peaks (3787 out of 3930 peaks). The co-occurrence of JUN and JUNB happens a lot at time point 12.

We are interested in, to what extent JUN/JUNB colocalize within the GR sites.

```{r}
# t1
JUN_GR_t1 <- intersect(JUN_t1, GR_t1)
JUNB_GR_t1 <- intersect(JUNB_t1, GR_t1)

print("At time point 1:")

JUN_t1_prop <- round(sum(overlapsAny(JUN_GR_t1, JUNB_GR_t1))/length(JUN_GR_t1), digits = 4) * 100
print(paste0("Of the JUN sites within GR sites, ", as.character(JUN_t1_prop), "% overlap JUNB sites within GR sites."))

JUNB_t1_prop <- round(sum(overlapsAny(JUNB_GR_t1, JUN_GR_t1))/length(JUNB_GR_t1), digits = 4) * 100
print(paste0("Of the JUNB sites within GR sites, ", as.character(JUNB_t1_prop), "% overlap JUN sites within GR sites."))
```

```{r}
# t12
JUN_GR_t12 <- intersect(JUN_t12, GR_t12)
JUNB_GR_t12 <- intersect(JUNB_t12, GR_t12)

print("At time point 12:")

suppressWarnings({
  JUN_t12_prop <- round(sum(overlapsAny(JUN_GR_t12, JUNB_GR_t12))/length(JUN_GR_t12), digits = 4) * 100
})
print(paste0("Of the JUN sites within GR sites, ", as.character(JUN_t12_prop), "% overlap JUNB sites within GR sites."))

suppressWarnings({
  JUNB_t12_prop <- round(sum(overlapsAny(JUNB_GR_t12, JUN_GR_t12))/length(JUNB_GR_t12), digits = 4) * 100
})
print(paste0("Of the JUNB sites within GR sites, ", as.character(JUNB_t12_prop), "% overlap JUN sites within GR sites."))
```



